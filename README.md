

```markdown
# üöÄ Trino + PostgreSQL + ClickHouse: –§–µ–¥–µ—Ä–∞—Ç–∏–≤–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤ Docker

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç, –∫–∞–∫ —Å –ø–æ–º–æ—â—å—é **Trino** –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ **PostgreSQL** –∏ **ClickHouse** –≤ –æ–¥–Ω–æ–º SQL-–∑–∞–ø—Ä–æ—Å–µ.  
Trino –≤—ã—Å—Ç—É–ø–∞–µ—Ç –∫–∞–∫ —Ñ–µ–¥–µ—Ä–∞—Ç–∏–≤–Ω—ã–π SQL-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä, –ø–æ–∑–≤–æ–ª—è—è –≤—ã–ø–æ–ª–Ω—è—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É "–Ω–∞ –ª–µ—Ç—É" –±–µ–∑ ETL.

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
<img width="280" height="247" alt="image" src="https://github.com/user-attachments/assets/a56f295a-d846-48bb-bd4b-d6577d872378" />


![–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](https://github.com/user-attachments/assets/524bdc33-bc7b-4119-814b-976575f92f50)

---

## ‚öôÔ∏è –ó–∞–ø—É—Å–∫ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```bash
docker-compose up -d
```

–ü—Ä–æ–≤–µ—Ä—å —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:

```bash
docker-compose logs -f
```

–û–∂–∏–¥–∞–µ–º—ã–µ –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã: `trino`, `postgres`, `clickhouse`.

---

## üì• –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

### 1. PostgreSQL: —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –∏ –≤—Å—Ç–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

–ü–æ–¥–∫–ª—é—á–∏—Å—å –∫ PostgreSQL:

```bash
docker exec -it postgres psql -U trino -d demo
```

–í—ã–ø–æ–ª–Ω–∏ SQL:

```sql
CREATE TABLE public.orders (
    order_id SERIAL PRIMARY KEY,
    customer_name VARCHAR(100),
    amount DECIMAL
);

INSERT INTO public.orders (customer_name, amount) VALUES
('Alice', 120.50),
('Bob', 300.00),
('Charlie', 50.75);
```

–í—ã–π–¥–∏ –∏–∑ —Å–µ—Å—Å–∏–∏:

```sql
\q
```

---

### 2. ClickHouse: —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –∏ –≤—Å—Ç–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

–ü–æ–¥–∫–ª—é—á–∏—Å—å –∫ ClickHouse:

```bash
docker exec -it clickhouse clickhouse-client -u trino --password trino
```

–í—ã–ø–æ–ª–Ω–∏:

```sql
CREATE TABLE default.payments (
    payment_id UInt32,
    order_id UInt32,
    status String
) ENGINE = MergeTree()
ORDER BY payment_id;

INSERT INTO default.payments VALUES
(1, 1, 'Paid'),
(2, 2, 'Pending'),
(3, 3, 'Paid');
```

–ü—Ä–æ–≤–µ—Ä—å:

```sql
SELECT * FROM default.payments;
```

–í—ã–π–¥–∏:

```sql
exit
```

---

## üîç –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Trino

```bash
docker exec -it trino trino
```

---

## üß™ –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –≤ Trino

### –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –ø–æ–¥–∫–ª—é—á—ë–Ω–Ω—ã–µ –∫–∞—Ç–∞–ª–æ–≥–∏

```sql
SHOW CATALOGS;
```

### –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ö–µ–º—ã

```sql
SHOW SCHEMAS FROM postgres;
SHOW SCHEMAS FROM clickhouse;
```

### –ü–æ–∫–∞–∑–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã

```sql
SHOW TABLES FROM postgres.public;
SHOW TABLES FROM clickhouse.default;
```

---

## üîÑ –§–µ–¥–µ—Ä–∞—Ç–∏–≤–Ω—ã–π –∑–∞–ø—Ä–æ—Å: –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ PostgreSQL –∏ ClickHouse

> ‚ö†Ô∏è ClickHouse —Ö—Ä–∞–Ω–∏—Ç —Å—Ç—Ä–æ–∫–∏ –∫–∞–∫ `String`, –Ω–æ Trino –º–æ–∂–µ—Ç –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –∫–∞–∫ `VARBINARY`.  
> –ò—Å–ø–æ–ª—å–∑—É–π `from_utf8()` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.

```sql
SELECT 
    o.order_id,
    o.customer_name,
    from_utf8(p.status) AS status
FROM postgres.public.orders o
JOIN clickhouse.default.payments p
    ON o.order_id = p.order_id;
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**

| order_id | customer_name | status  |
|----------|---------------|---------|
| 1        | Alice         | Paid    |
| 2        | Bob           | Pending |
| 3        | Charlie       | Paid    |

---

## üß© –ü—Ä–∏–º–µ—Ä—ã —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –¥–≤—É—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (`UNION ALL`)

```sql
SELECT 'pg' AS source, order_id, customer_name, NULL AS status
FROM postgres.public.orders

UNION ALL

SELECT 'ch' AS source, order_id, NULL AS customer_name, from_utf8(status)
FROM clickhouse.default.payments;
```

### –ê–≥—Ä–µ–≥–∞—Ü–∏—è –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º

```sql
SELECT 
    'pg' AS source,
    COUNT(*) AS cnt
FROM postgres.public.orders

UNION ALL

SELECT 
    'ch' AS source,
    COUNT(*) AS cnt
FROM clickhouse.default.payments;
```

---

## ‚ö†Ô∏è –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: —á—Ç–æ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å

Trino ‚Äî —Ñ–µ–¥–µ—Ä–∞—Ç–∏–≤–Ω–∞—è –°–£–ë–î, –ø–æ–∑–≤–æ–ª—è—é—â–∞—è –æ–±—ä–µ–¥–∏–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –≤ –æ–¥–Ω–æ–º SQL-–∑–∞–ø—Ä–æ—Å–µ.

### ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞
- –ù–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ.
- –ì–∏–±–∫–æ—Å—Ç—å: –∞–Ω–∞–ª–∏–∑ "–Ω–∞ –ª–µ—Ç—É".
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–æ–≤ (S3, Kafka, MySQL, Hive –∏ –¥—Ä.).

### ‚ùå –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ >2‚Äì5 –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- **–°–µ—Ç–µ–≤–æ–π –æ–≤–µ—Ä—Ö–µ–¥** ‚Äî –¥–∞–Ω–Ω—ã–µ —Ç—è–Ω—É—Ç—Å—è –ø–æ —Å–µ—Ç–∏.
- **Pushdown –Ω–µ –≤—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç** ‚Äî —Ñ–∏–ª—å—Ç—Ä—ã –º–æ–≥—É—Ç –Ω–µ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å—Å—è –≤ –∏—Å—Ç–æ—á–Ω–∏–∫.
- **–ö–æ–Ω–≤–µ—Ä—Å–∏—è —Ç–∏–ø–æ–≤** ‚Äî –æ—Å–æ–±–µ–Ω–Ω–æ —Å ClickHouse (`String` ‚Üí `VARBINARY`).
- **–ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä** ‚Äî –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å —É–∑–∫–∏–º –º–µ—Å—Ç–æ–º.

> üí° **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –∏—Å–ø–æ–ª—å–∑—É–π 2‚Äì4 –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –≤ –æ–¥–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ.  
> –î–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ ‚Äî –ø–æ—Å—Ç—Ä–æ–π ETL-–ø–∞–π–ø–ª–∞–π–Ω—ã (Airflow, dbt) –∏–ª–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑—É–π –¥–∞–Ω–Ω—ã–µ.

---

## üõ†Ô∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### 1. –Ø–≤–Ω–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ –¥–≤–∏–∂–∫–∞ –≤ ClickHouse

```sql
ENGINE = MergeTree ORDER BY payment_id
```

### 2. –ò–Ω–¥–µ–∫—Å—ã –≤ ClickHouse
–ò—Å–ø–æ–ª—å–∑—É–π `ORDER BY`, `PRIMARY KEY` –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ pushdown

```sql
EXPLAIN
SELECT * FROM postgres.public.orders WHERE amount > 100;
```

–ï—Å–ª–∏ –≤ –ø–ª–∞–Ω–µ –µ—Å—Ç—å `remote` —Ñ–∏–ª—å—Ç—Ä ‚Äî –∑–Ω–∞—á–∏—Ç, `WHERE` –±—ã–ª –ø–µ—Ä–µ–¥–∞–Ω –≤ PostgreSQL (**predicate pushdown**).

---

## ‚úÖ –ò—Ç–æ–≥

–° –ø–æ–º–æ—â—å—é —ç—Ç–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ —Ç—ã –º–æ–∂–µ—à—å:
- –í—ã–ø–æ–ª–Ω—è—Ç—å SQL-–∑–∞–ø—Ä–æ—Å—ã –∫ —Ä–∞–∑–Ω—ã–º –ë–î –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.
- –ü—Ä–æ–≤–æ–¥–∏—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É –±–µ–∑ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.
- –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ñ–µ–¥–µ—Ä–∞—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ Trino.

---

## üìö –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

- –ü–æ–¥–∫–ª—é—á–∏ **S3 / Iceberg / Hive** —á–µ—Ä–µ–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä—ã.
- –ù–∞—Å—Ç—Ä–æ–π **–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é** (JWT, LDAP, OAuth).
- –†–∞–∑–≤–µ—Ä–Ω–∏ **–∫–ª–∞—Å—Ç–µ—Ä Trino** (–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä + –≤–æ—Ä–∫–µ—Ä—ã).
- –ü–æ–ø—Ä–æ–±—É–π **–º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è** (—á–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã).
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π —Å BI-—Å–∏—Å—Ç–µ–º–∞–º–∏: **Superset**, **Metabase**, **Tableau**.

---

> ‚ú® **Trino –¥–µ–ª–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω—ã–º SQL –ø–æ–≤–µ—Ä—Ö –≤—Å–µ–≥–æ.**
```


